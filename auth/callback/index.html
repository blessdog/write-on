<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Signing in — Write On</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0a0a0f;
    color: #e0f0ec;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    text-align: center;
  }
  .container { padding: 2rem; max-width: 420px; }
  h2 { font-size: 1.3rem; margin-bottom: 1rem; }
  p { font-size: 0.9rem; color: #6a8a82; margin-bottom: 0.5rem; }
  .btn-open {
    display: inline-block;
    margin-top: 1.5rem;
    padding: 14px 40px;
    background: #3dffd8;
    color: #0a0a0f;
    font-size: 1rem;
    font-weight: 600;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-decoration: none;
    transition: background 0.2s;
  }
  .btn-open:hover { background: #2ee0be; }
  .error { color: #ff6b6b; }
  .success { color: #3dffd8; }
  .hint { font-size: 0.85rem; color: #6a8a82; margin-top: 1.5rem; line-height: 1.6; }
</style>
</head>
<body>
<div class="container">
  <h2 id="heading">Signing you in...</h2>
  <p id="status">Click the button below to open Write On</p>
  <a id="openBtn" class="btn-open" href="#">Open Write On</a>
  <p class="hint" id="hint"></p>
</div>
<script>
(function() {
  var hash = window.location.hash.substring(1);
  var query = window.location.search.substring(1);
  var tokenData = hash || query;

  if (!tokenData) {
    document.getElementById('heading').textContent = 'Sign-in Error';
    document.getElementById('status').className = 'error';
    document.getElementById('status').textContent = 'No authentication data received.';
    document.getElementById('openBtn').style.display = 'none';
    return;
  }

  var deepLink = 'writeon://auth/callback#' + tokenData;
  var btn = document.getElementById('openBtn');
  btn.href = deepLink;

  // When user clicks the button, redirect to homepage after a short delay
  btn.addEventListener('click', function() {
    document.getElementById('heading').textContent = 'Sign-in complete!';
    document.getElementById('heading').className = 'success';
    document.getElementById('status').textContent = 'Redirecting...';
    document.getElementById('status').className = 'success';
    btn.style.display = 'none';
    document.getElementById('hint').textContent = '';
    setTimeout(function() {
      window.location.href = 'https://write-on.app/';
    }, 1500);
  });

  // Try automatic redirect
  window.location.href = deepLink;

  // Show guidance after delay
  setTimeout(function() {
    document.getElementById('hint').innerHTML =
      'If Write On opened, you\'re all set — close this tab.<br>' +
      'If not, click the button above or allow the popup.';
  }, 2000);
})();
</script>
</body>
</html>
